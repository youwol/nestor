name: Run Typescript Tests
description: Run Typescript tests, into path if specified
author: jdecharne@youwol.com


inputs:

  path:
    description: >
      The path of the Typescript repository where to execute tests.
      Default to empty : tests will be executed into the workflow workspace
    default: ''

  on-failure:
    description: >
      What to do if tests failed :
      - 'fatal' : the action failed
      - 'warning' : issue a warning
      Default to 'fatal'
    default: 'fatal'


outputs:

  result:
    description: Result of the tests
    value: ${{ steps.yarn_test.outcome }}


runs:
  using: composite

  steps:
    - name: Check Parameters
      id: check_params
      if: inputs.on-failure != 'fatal' && inputs.on-failure != 'warning'
      run: |
        echo "::error title=Invalid parameter for ts/tests::'${{ inputs.on-failure }}' is invalid for on-failure, only 'fatal' or 'warning'." 
        exit 1
      shell: sh

    - name: Yarn Test
      id: yarn_test
      working-directory: ${{ inputs.path }}
      continue-on-error: true
      run: yarn test
      shell: sh

    - name: Failure
      id: yarn_test_failure
      if: steps.yarn_test.outcome == 'failure' && inputs.on-failure == 'fatal'
      run: echo "::error title=Tests failure for ${{ github.job }}::See job log"
      shell: sh

    - name: Warning
      id: yarn_test_warning
      if: steps.yarn_test.outcome == 'failure' && inputs.on-failure == 'warning'
      run: echo "::warning title=Tests failure for ${{ github.job }}::Some tests failed, but action configured to only emit waring. See job log for details"
      shell: sh
